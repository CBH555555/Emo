<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üé≠ EROPOLY</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --romantik: #ff1493; --kuscheln: #00bfff; --femdom: #8b00ff;
            --bdsm: #ff4500; --hotwife: #ff69b4; --cuckold: #32cd32; --keuschheit: #ffd700;
            --bg-dark: #1a0f2e; --bg-card: #3d2857; --gold: #ffd700;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark), #1f1038, var(--bg-dark));
            color: white; min-height: 100vh; overflow-x: hidden;
        }
        
        /* Header - Halb so hoch */
        .game-header {
            background: linear-gradient(135deg, #8b00ff, #ff1493, #32cd32);
            padding: 1px 3px; border-radius: 3px; position: sticky; top: 0; z-index: 200;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .header-layout {
            display: flex; justify-content: space-between; align-items: center; gap: 3px;
        }
        .header-player { 
            flex: 1; font-size: 0.58rem; font-weight: 700; line-height: 1.1;
            text-shadow: 0 1px 3px rgba(0,0,0,0.8), 0 0 5px rgba(0,0,0,0.5);
        }
        .header-player.left { text-align: left; color: #ff1493; }
        .header-player.right { text-align: right; color: #32cd32; }
        .header-center {
            flex: 0 0 auto; display: flex; align-items: center; gap: 2px;
        }
        .header-title {
            font-family: 'Playfair Display', serif; font-size: 0.5rem;
            font-weight: 900; letter-spacing: 0.2px;
        }
        .die {
            width: 22px; height: 22px; background: linear-gradient(145deg, #fff, #f0f0f0);
            color: var(--bg-dark); display: flex; justify-content: center; align-items: center;
            font-size: 0.75rem; font-weight: 700; border-radius: 3px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3); user-select: none;
        }
        .die.rolling { animation: roll 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        @keyframes roll {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .header-buttons {
            display: flex; gap: 2px;
        }
        .btn-header {
            background: linear-gradient(135deg, #8b00ff, #ff1493);
            color: white; border: none; padding: 3px 6px; border-radius: 8px;
            font-size: 0.5rem; font-weight: 600; cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2); touch-action: manipulation;
            white-space: nowrap;
        }
        .btn-header:active { transform: scale(0.95); }
        .btn-header.secondary { background: linear-gradient(135deg, #666, #555); }
        .current-player { display: none; }
        
        /* Container */
        .container { max-width: 100%; margin: 0 auto; padding: 8px; }
        
        /* Game Layout */
        .game-layout {
            display: grid; grid-template-columns: 1fr; gap: 10px; margin-top: 8px;
        }
        
        /* Board */
        .board-section {
            background: linear-gradient(135deg, #fff5f8, #f0e6ff);
            border-radius: 10px; padding: 10px; box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }
        .board-container {
            position: relative; width: 100%; padding-bottom: 100%;
            background: linear-gradient(135deg, #fff5f8, #f0e6ff);
            border-radius: 8px; box-shadow: inset 0 0 20px rgba(138,43,226,0.15);
        }
        .board-inner { position: absolute; inset: 0; }
        .board-cell {
            position: absolute; width: 44px; height: 44px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; padding: 2px; border-radius: 4px; font-weight: 600;
            font-size: 0.36rem; box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.5); cursor: pointer;
            transition: all 0.2s;
        }
        .board-cell:active { transform: scale(0.95); }
        
        /* STARKE Besitzer-Markierung - Komplette Zelle */
        .board-cell.owned-frau {
            border: 4px solid #ff1493 !important;
            box-shadow: 0 0 12px rgba(255, 20, 147, 0.6), inset 0 0 15px rgba(255, 20, 147, 0.2) !important;
            background-blend-mode: overlay;
        }
        .board-cell.owned-mann {
            border: 4px solid #32cd32 !important;
            box-shadow: 0 0 12px rgba(50, 205, 50, 0.6), inset 0 0 15px rgba(50, 205, 50, 0.2) !important;
            background-blend-mode: overlay;
        }
        
        .cell-name { font-weight: 700; line-height: 0.85; font-size: 0.34rem; }
        .cell-price { font-size: 0.3rem; opacity: 0.9; margin-top: 1px; }
        
        /* Cell Colors */
        .cell-romantik { background: linear-gradient(135deg, var(--romantik), #c71585); color: white; }
        .cell-kuscheln { background: linear-gradient(135deg, var(--kuscheln), #0099cc); color: white; }
        .cell-femdom { background: linear-gradient(135deg, var(--femdom), #6600cc); color: white; }
        .cell-bdsm { background: linear-gradient(135deg, var(--bdsm), #cc3700); color: white; }
        .cell-hotwife { background: linear-gradient(135deg, var(--hotwife), var(--romantik)); color: white; }
        .cell-cuckold { background: linear-gradient(135deg, var(--cuckold), #228b22); color: white; }
        .cell-keuschheit { background: linear-gradient(135deg, var(--keuschheit), #daa520); color: #333; }
        .cell-corner { background: linear-gradient(135deg, #6a0dad, #8a2be2); color: white; width: 44px; height: 44px; border-radius: 50%; font-size: 0.38rem; }
        
        /* Zentrum - W√ºrfel & Buttons */
        .cell-center {
            position: absolute;
            background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);
            width: 100px; height: 100px; border-radius: 15px;
            border: 2px solid rgba(255,255,255,0.3);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            gap: 5px; padding: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .center-die {
            width: 45px; height: 45px; background: linear-gradient(145deg, #fff, #f0f0f0);
            color: var(--bg-dark); display: flex; justify-content: center; align-items: center;
            font-size: 1.5rem; font-weight: 700; border-radius: 8px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.4); user-select: none;
        }
        .center-die.rolling { animation: roll 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        .center-buttons {
            display: flex; gap: 3px;
        }
        .center-btn {
            background: linear-gradient(135deg, #8b00ff, #ff1493);
            color: white; border: none; padding: 6px 10px; border-radius: 10px;
            font-size: 0.65rem; font-weight: 600; cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3); touch-action: manipulation;
        }
        .center-btn:active { transform: scale(0.95); }
        .center-btn.secondary { background: linear-gradient(135deg, #666, #555); }
        
        /* Markers & Indicators */
        .player-marker {
            position: absolute; width: 24px; height: 24px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; font-size: 0.9rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.6); z-index: 20; border: 3px solid white;
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .marker-frau { background: linear-gradient(135deg, #ff1493, #ff69b4); top: -4px; left: 50%; transform: translateX(-50%); }
        .marker-mann { background: linear-gradient(135deg, #32cd32, #228b22); bottom: -4px; left: 50%; transform: translateX(-50%); }
        .hotel-indicator {
            position: absolute; top: 1px; right: 1px; width: 12px; height: 12px;
            background: linear-gradient(135deg, var(--gold), #ffed4e); border-radius: 50%;
            display: flex; justify-content: center; align-items: center; font-size: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.4);
        }
        .cell-owner-badge {
            position: absolute; bottom: 1px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.7); color: white; padding: 1px 3px; border-radius: 4px;
            font-size: 0.4rem; font-weight: 700;
        }
        
        /* Sections */
        .section {
            background: var(--bg-card); border-radius: 10px; padding: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 10px;
        }
        .section-title {
            font-size: 0.9rem; font-weight: 700; margin-bottom: 10px; color: var(--gold);
        }
        
        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #8b00ff, #ff1493); color: white; border: none;
            padding: 12px 18px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;
            cursor: pointer; width: 100%; margin-bottom: 8px; text-transform: uppercase;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2); touch-action: manipulation;
        }
        .btn:active { transform: scale(0.97); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-secondary { background: linear-gradient(135deg, #6c757d, #5a6268); }
        .btn-success { background: linear-gradient(135deg, #4caf50, #45a049); }
        .btn-danger { background: linear-gradient(135deg, #f44336, #da190b); }
        .btn-warning { background: linear-gradient(135deg, #ff9800, #f57c00); }
        
        /* Theme Blocks */
        .theme-block {
            background: rgba(255,255,255,0.05); border-radius: 8px; padding: 10px;
            margin-bottom: 8px; border-left: 4px solid;
        }
        .theme-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;
        }
        .theme-name { font-weight: 700; font-size: 0.8rem; }
        .theme-stats { display: flex; gap: 6px; font-size: 0.7rem; }
        .monopoly-badge {
            background: rgba(255,215,0,0.2); color: var(--gold); padding: 2px 6px;
            border-radius: 8px; font-size: 0.65rem; font-weight: 700; margin-left: 4px;
        }
        .streets-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 6px;
        }
        .street-item {
            background: rgba(0,0,0,0.2); padding: 5px; border-radius: 5px; font-size: 0.7rem;
            display: flex; justify-content: space-between; align-items: center;
        }
        
        /* Task Container - Editierbar */
        .task-container {
            background: rgba(255,255,255,0.05); border-radius: 8px; padding: 10px;
            margin-bottom: 8px; border-left: 3px solid var(--gold);
        }
        .task-category {
            font-weight: 700; font-size: 0.85rem; margin-bottom: 6px; color: var(--gold);
        }
        .task-list {
            list-style: none; padding: 0; font-size: 0.75rem;
        }
        .task-list li {
            padding: 4px 0 4px 12px; position: relative; line-height: 1.3;
        }
        .task-list li::before {
            content: '‚ñ∏'; position: absolute; left: 0; color: #ff1493; font-weight: 700;
        }
        
        /* Modal */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); backdrop-filter: blur(10px);
            display: flex; justify-content: center; align-items: center; z-index: 1000;
            padding: 15px; animation: fadeIn 0.3s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal-content {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-dark));
            border-radius: 12px; padding: 20px; max-width: 500px; width: 100%;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5); border: 2px solid rgba(255,255,255,0.2);
            max-height: 85vh; overflow-y: auto; animation: slideUp 0.4s;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .modal-title {
            font-size: 1.1rem; font-weight: 700; color: var(--gold);
            margin-bottom: 12px; text-align: center;
        }
        .modal-text {
            font-size: 1rem; line-height: 1.5; margin-bottom: 15px; text-align: center;
            padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;
            border: 1px dashed rgba(255,255,255,0.2);
        }
        .modal-buttons { display: flex; flex-direction: column; gap: 10px; }
        
        .hidden { display: none !important; }
        
        /* Instructions - Klein */
        .instructions {
            background: linear-gradient(135deg, rgba(138,43,226,0.1), rgba(255,105,180,0.1));
            border-radius: 6px; padding: 6px; margin-top: 6px; border: 1px solid rgba(255,255,255,0.1);
        }
        .instructions-title { font-size: 0.7rem; font-weight: 700; margin-bottom: 4px; color: var(--gold); }
        .instructions-list { list-style: none; padding: 0; font-size: 0.6rem; }
        .instructions-list li { padding: 2px 0 2px 10px; position: relative; line-height: 1.2; }
        .instructions-list li::before { content: '‚ñ∏'; position: absolute; left: 0; color: #ff1493; font-size: 0.5rem; }
        
        /* Desktop */
        @media (min-width: 768px) {
            .container { max-width: 1400px; padding: 15px; }
            .game-layout { grid-template-columns: 2fr 1fr; }
            .board-cell { width: 60px; height: 60px; font-size: 0.5rem; }
            .cell-corner { width: 62px; height: 62px; }
            .die { width: 55px; height: 55px; font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header - Halb so hoch -->
        <header class="game-header">
            <div class="header-layout">
                <div class="header-player left">
                    <span style="background: rgba(0,0,0,0.4); padding: 2px 5px; border-radius: 5px; border: 1px solid rgba(255,20,147,0.5);">
                        üëë <span id="headerFrauMoney">‚Ç¨3.500</span> | <span id="headerFrauHotels">0</span>üè®
                    </span>
                </div>
                <div class="header-center">
                    <div class="header-title">EROPOLY</div>
                    <div class="die" id="die1">?</div>
                    <div class="header-buttons">
                        <button class="btn-header" id="rollBtn">üé≤</button>
                        <button class="btn-header secondary" id="endTurnBtn">‚è≠Ô∏è</button>
                    </div>
                </div>
                <div class="header-player right">
                    <span style="background: rgba(0,0,0,0.4); padding: 2px 5px; border-radius: 5px; border: 1px solid rgba(50,205,50,0.5);">
                        üîí <span id="headerMannMoney">‚Ç¨3.500</span> | <span id="headerMannHotels">0</span>üè®
                    </span>
                </div>
            </div>
        </header>
        
        <div class="game-layout">
            <!-- Spielfeld -->
            <main>
                <div class="board-section">
                    <div class="board-container">
                        <div class="board-inner" id="boardContainer"></div>
                    </div>
                </div>
            </main>
            
            <!-- Sidebar -->
            <aside>
                <!-- Stra√üen-√úbersicht -->
                <section class="section">
                    <h2 class="section-title">üèòÔ∏è Stra√üen & Monopole</h2>
                    <div id="themeBlocksContainer"></div>
                </section>
                
                <!-- Aktionen -->
                <section class="section">
                    <h2 class="section-title">‚ö° Aktionen</h2>
                    <button class="btn btn-warning" id="tradeBtn">üí± Handel (Kostenlos)</button>
                    <button class="btn btn-danger" id="theftBtn">üí∞ Diebstahl (‚Ç¨200)</button>
                    <button class="btn" id="forceTaskBtn">üéØ Aufgabe erzwingen (‚Ç¨150)</button>
                </section>
                
                <!-- Aufgaben-Container (Editierbar) -->
                <section class="section">
                    <h2 class="section-title">üìù Aufgaben-√úbersicht</h2>
                    <div id="tasksContainer">
                        <!-- Wird dynamisch gef√ºllt -->
                    </div>
                </section>
                
                <!-- Spielende -->
                <section class="section">
                    <h2 class="section-title">üèÅ Spielende</h2>
                    <button class="btn btn-success" id="endGameBtn">üí∞ Endergebnis berechnen</button>
                </section>
                
                <!-- Spielregeln ganz unten -->
                <section class="section">
                    <div class="instructions">
                        <div class="instructions-title">üìã Spielregeln</div>
                        <ul class="instructions-list">
                            <li>W√ºrfeln und bewegen</li>
                            <li>Stra√üen kaufen</li>
                            <li>Hotel nur bei Monopol (alle 3 Stra√üen)</li>
                            <li>Fremde Hotels: Miete ODER Aufgabe</li>
                            <li>LOS = ‚Ç¨200</li>
                            <li>Ende: Verm√∂gen √∑ 1000 = Realer ‚Ç¨</li>
                        </ul>
                    </div>
                </section>
            </aside>
        </div>
    </div>
    
    <!-- Task Modal -->
    <div id="taskModal" class="hidden"></div>

    <script>
        // =================== GAME STATE ===================
        const gameState = {
            currentPlayer: 'frau',
            frauMoney: 3500,
            mannMoney: 3500,
            frauPosition: 0,
            mannPosition: 0,
            gameActive: true,
            _h: { hd: 1.25, rd: 0.80, et: 0.60, pb: 250, ld: 0.20 }
        };

        // =================== AUFGABEN (Editierbar als Container) ===================
        const taskCategories = {
            romantik: {
                name: "üíñ Romantik",
                tasks: [
                    "Ehemann: Massiere Ehefraus R√ºcken 3 Min",
                    "Ehefrau: Nur Unterw√§sche, bleib so 2 Min",
                    "Ehemann: K√ºsse Ehefraus Hals 1 Min",
                    "Beide: Zungenkuss 30 Sek",
                    "Ehemann: Streichle Ehefraus Br√ºste (durch Kleidung) 1 Min"
                ]
            },
            kuscheln: {
                name: "ü§ó Kuscheln",
                tasks: [
                    "Ehemann: Umarme Ehefrau von hinten 1 Min",
                    "Wahrheit: Ehemann, wann warst du zuletzt richtig geil?",
                    "L√∂ffelchen 2 Min",
                    "Wahrheit: Ehefrau, wann dachtest du an anderen Mann?"
                ]
            },
            femdom: {
                name: "üë† Femdom",
                tasks: [
                    "Ehemann: Knie nieder, massiere Ehefraus Beine",
                    "Ehefrau: Gib Befehl, Ehemann f√ºhrt aus",
                    "Wahrheit: Ehemann, warum verdient sie Kontrolle?",
                    "Ehefrau: Ohrfeige seinen Po 5x"
                ]
            },
            bdsm: {
                name: "üîê BDSM",
                tasks: [
                    "Ehemann: 10 Klapse nackter Po",
                    "Ehefrau: Kneife 5x in Brustwarzen",
                    "Ehemann: Unbequeme Position 1 Min",
                    "Augen verbinden, Ehefrau ber√ºhrt 1 Min"
                ]
            },
            hotwife: {
                name: "üíÉ Hotwife",
                tasks: [
                    "Wahrheit: Ehefrau, 3 Gr√ºnde f√ºr anderen Mann?",
                    "Ehefrau: Tanze 30 Sek sexy",
                    "Ehefrau: Zieh dich aus, pr√§sentiere 1 Min",
                    "Wahrheit: Ehefrau, beschreibe Traummann"
                ]
            },
            cuckold: {
                name: "üëÅÔ∏è Cuckold",
                tasks: [
                    "Wahrheit: Ehemann, warum verdient sie Besseren?",
                    "Ehemann: Danke ihr, dass sie bleibt",
                    "Ehemann: Putze ihre Schuhe",
                    "Wahrheit: Ehemann, zu schnell gekommen?"
                ]
            },
            keuschheit: {
                name: "üîí Keuschheit",
                tasks: [
                    "Penis-Check: Unter 15cm? Zahle ‚Ç¨100",
                    "Wahrheit: Ehemann, wie oft denkst du an Sex?",
                    "Ehefrau: Bestimme, wann er kommen darf",
                    "Wahrheit: Ehefrau, warum ist Dildo besser?"
                ]
            }
        };

        // =================== THEMEN ===================
        const themeBlocks = {
            romantik: {
                name: "üíñ Romantik",
                color: "romantik",
                streets: [
                    { id: 1, name: "Rosen-Allee", price: 200, hotelCost: 100, owner: null, hasHotel: false },
                    { id: 2, name: "Kerzen-Gasse", price: 220, hotelCost: 110, owner: null, hasHotel: false },
                    { id: 3, name: "Kuss-Boulevard", price: 240, hotelCost: 120, owner: null, hasHotel: false }
                ]
            },
            kuscheln: {
                name: "ü§ó Kuscheln",
                color: "kuscheln",
                streets: [
                    { id: 4, name: "Kuschel-Stra√üe", price: 180, hotelCost: 90, owner: null, hasHotel: false },
                    { id: 5, name: "Streichel-Gasse", price: 200, hotelCost: 100, owner: null, hasHotel: false },
                    { id: 6, name: "Umarmungs-Allee", price: 210, hotelCost: 105, owner: null, hasHotel: false }
                ]
            },
            femdom: {
                name: "üë† Femdom",
                color: "femdom",
                streets: [
                    { id: 7, name: "Kommando-Allee", price: 300, hotelCost: 150, owner: null, hasHotel: false },
                    { id: 8, name: "Gehorsam-Gasse", price: 320, hotelCost: 160, owner: null, hasHotel: false },
                    { id: 9, name: "Kontroll-Stra√üe", price: 350, hotelCost: 175, owner: null, hasHotel: false }
                ]
            },
            bdsm: {
                name: "üîê BDSM",
                color: "bdsm",
                streets: [
                    { id: 10, name: "Fessel-Gasse", price: 280, hotelCost: 140, owner: null, hasHotel: false },
                    { id: 11, name: "Schmerz-Allee", price: 310, hotelCost: 155, owner: null, hasHotel: false },
                    { id: 12, name: "Sinnes-Stra√üe", price: 330, hotelCost: 165, owner: null, hasHotel: false }
                ]
            },
            hotwife: {
                name: "üíÉ Hotwife",
                color: "hotwife",
                streets: [
                    { id: 13, name: "Flirt-Boulevard", price: 260, hotelCost: 130, owner: null, hasHotel: false },
                    { id: 14, name: "Verf√ºhrungs-Allee", price: 290, hotelCost: 145, owner: null, hasHotel: false },
                    { id: 15, name: "Attraktivit√§ts-Stra√üe", price: 310, hotelCost: 155, owner: null, hasHotel: false }
                ]
            },
            cuckold: {
                name: "üëÅÔ∏è Cuckold",
                color: "cuckold",
                streets: [
                    { id: 16, name: "Beobachtungs-Gasse", price: 270, hotelCost: 135, owner: null, hasHotel: false },
                    { id: 17, name: "Dienst-Allee", price: 300, hotelCost: 150, owner: null, hasHotel: false },
                    { id: 18, name: "Dem√ºtigungs-Stra√üe", price: 340, hotelCost: 170, owner: null, hasHotel: false }
                ]
            },
            keuschheit: {
                name: "üîí Keuschheit",
                color: "keuschheit",
                streets: [
                    { id: 19, name: "Enthaltsamkeits-Allee", price: 350, hotelCost: 175, owner: null, hasHotel: false },
                    { id: 20, name: "K√§fig-Gasse", price: 400, hotelCost: 200, owner: null, hasHotel: false },
                    { id: 21, name: "Kontrolle-Boulevard", price: 450, hotelCost: 225, owner: null, hasHotel: false }
                ]
            }
        };

        // =================== BOARD POSITIONS (Rechteck, GLEICHE Verteilung) ===================
        const boardPositions = [
            // Unten (START) - 8 Felder
            { top: '88%', left: '88%', theme: 'corner', name: 'LOS' },
            { top: '88%', left: '76%', theme: 'romantik', streetId: 1 },
            { top: '88%', left: '64%', theme: 'corner', name: 'üéÅ' },
            { top: '88%', left: '52%', theme: 'romantik', streetId: 2 },
            { top: '88%', left: '40%', theme: 'corner', name: 'üí°' },
            { top: '88%', left: '28%', theme: 'romantik', streetId: 3 },
            { top: '88%', left: '16%', theme: 'kuscheln', streetId: 4 },
            { top: '88%', left: '8%', theme: 'corner', name: '‚ö°' },
            
            // Links - 7 Felder (gleich wie rechts!)
            { top: '76%', left: '8%', theme: 'kuscheln', streetId: 5 },
            { top: '64%', left: '8%', theme: 'corner', name: 'üé≤' },
            { top: '52%', left: '8%', theme: 'kuscheln', streetId: 6 },
            { top: '40%', left: '8%', theme: 'femdom', streetId: 7 },
            { top: '28%', left: '8%', theme: 'femdom', streetId: 8 },
            { top: '16%', left: '8%', theme: 'corner', name: 'üí°' },
            { top: '8%', left: '8%', theme: 'corner', name: '‚è∏Ô∏è' },
            
            // Oben - 8 Felder
            { top: '8%', left: '16%', theme: 'femdom', streetId: 9 },
            { top: '8%', left: '28%', theme: 'bdsm', streetId: 10 },
            { top: '8%', left: '40%', theme: 'bdsm', streetId: 11 },
            { top: '8%', left: '52%', theme: 'corner', name: 'üÖøÔ∏è' },
            { top: '8%', left: '64%', theme: 'bdsm', streetId: 12 },
            { top: '8%', left: '76%', theme: 'hotwife', streetId: 13 },
            { top: '8%', left: '88%', theme: 'hotwife', streetId: 14 },
            
            // Rechts - 7 Felder (gleich wie links!)
            { top: '16%', left: '88%', theme: 'hotwife', streetId: 15 },
            { top: '28%', left: '88%', theme: 'cuckold', streetId: 16 },
            { top: '40%', left: '88%', theme: 'cuckold', streetId: 17 },
            { top: '52%', left: '88%', theme: 'cuckold', streetId: 18 },
            { top: '64%', left: '88%', theme: 'keuschheit', streetId: 19 },
            { top: '76%', left: '88%', theme: 'keuschheit', streetId: 20 },
            { top: '82%', left: '88%', theme: 'keuschheit', streetId: 21 },
            
            // ZENTRUM f√ºr W√ºrfel & Buttons (besser zentriert)
            { top: '48%', left: '50%', theme: 'center', name: 'CENTER' }
        ];

        // =================== INIT ===================
        function initGame() {
            renderBoard();
            renderThemeBlocks();
            renderTasksOverview();
            updatePlayerInfo();
            setupEventListeners();
        }

        // =================== RENDER TASKS OVERVIEW ===================
        function renderTasksOverview() {
            const container = document.getElementById('tasksContainer');
            container.innerHTML = '';
            
            Object.entries(taskCategories).forEach(([key, category]) => {
                const taskBlock = document.createElement('div');
                taskBlock.className = 'task-container';
                taskBlock.innerHTML = `
                    <div class="task-category">${category.name}</div>
                    <ul class="task-list">
                        ${category.tasks.map(task => `<li>${task}</li>`).join('')}
                    </ul>
                `;
                container.appendChild(taskBlock);
            });
        }

        // =================== MONOPOLY CHECK ===================
        function hasMonopoly(player, themeKey) {
            return themeBlocks[themeKey].streets.every(s => s.owner === player);
        }

        // =================== RENDER BOARD ===================
        function renderBoard() {
            const container = document.getElementById('boardContainer');
            container.innerHTML = '';
            
            boardPositions.forEach((pos, index) => {
                const cell = document.createElement('div');
                
                // ZENTRUM - W√ºrfel & Buttons
                if (pos.theme === 'center') {
                    cell.className = 'cell-center';
                    cell.style.top = pos.top;
                    cell.style.left = pos.left;
                    cell.style.transform = 'translate(-50%, -50%)';
                    cell.innerHTML = `
                        <div class="center-die" id="centerDie">?</div>
                        <div class="center-buttons">
                            <button class="center-btn" id="centerRollBtn">üé≤</button>
                            <button class="center-btn secondary" id="centerEndBtn">‚è≠Ô∏è</button>
                        </div>
                    `;
                    container.appendChild(cell);
                    
                    // Event listeners f√ºr Center-Buttons
                    setTimeout(() => {
                        document.getElementById('centerRollBtn').addEventListener('click', rollDice);
                        document.getElementById('centerEndBtn').addEventListener('click', endTurn);
                    }, 100);
                    return;
                }
                
                cell.className = `board-cell cell-${pos.theme}`;
                cell.style.top = pos.top;
                cell.style.left = pos.left;
                cell.style.transform = 'translate(-50%, -50%)';
                cell.id = `cell-${index}`;
                
                if (pos.theme === 'corner') {
                    cell.innerHTML = `<div class="cell-name">${pos.name}</div>`;
                } else {
                    const theme = Object.values(themeBlocks).find(t => 
                        t.streets.some(s => s.id === pos.streetId)
                    );
                    const street = theme?.streets.find(s => s.id === pos.streetId);
                    
                    if (street) {
                        // STARKE BESITZER-MARKIERUNG
                        if (street.owner) {
                            cell.classList.add(`owned-${street.owner}`);
                        }
                        
                        cell.innerHTML = `
                            <div class="cell-name">${street.name}</div>
                            <div class="cell-price">‚Ç¨${street.price}</div>
                        `;
                        
                        if (street.owner) {
                            const badge = document.createElement('div');
                            badge.className = 'cell-owner-badge';
                            badge.textContent = street.owner === 'frau' ? 'üëë' : 'üîí';
                            cell.appendChild(badge);
                        }
                        
                        if (street.hasHotel) {
                            const hotel = document.createElement('div');
                            hotel.className = 'hotel-indicator';
                            hotel.textContent = 'üè®';
                            cell.appendChild(hotel);
                        }
                    }
                }
                
                container.appendChild(cell);
            });
            
            updatePlayerMarkers();
        }

        function updatePlayerMarkers() {
            document.querySelectorAll('.player-marker').forEach(m => m.remove());
            
            const frauCell = document.getElementById(`cell-${gameState.frauPosition}`);
            const mannCell = document.getElementById(`cell-${gameState.mannPosition}`);
            
            if (frauCell) {
                const m = document.createElement('div');
                m.className = 'player-marker marker-frau';
                m.textContent = 'üëë';
                frauCell.appendChild(m);
            }
            
            if (mannCell) {
                const m = document.createElement('div');
                m.className = 'player-marker marker-mann';
                m.textContent = 'üîí';
                mannCell.appendChild(m);
            }
        }

        // =================== RENDER THEMES ===================
        function renderThemeBlocks() {
            const container = document.getElementById('themeBlocksContainer');
            container.innerHTML = '';
            
            Object.entries(themeBlocks).forEach(([key, theme]) => {
                const ownedByFrau = theme.streets.filter(s => s.owner === 'frau').length;
                const ownedByMann = theme.streets.filter(s => s.owner === 'mann').length;
                const hotels = theme.streets.filter(s => s.hasHotel).length;
                const frauMonopoly = hasMonopoly('frau', key);
                const mannMonopoly = hasMonopoly('mann', key);
                
                const block = document.createElement('div');
                block.className = 'theme-block';
                block.style.borderLeftColor = `var(--${theme.color})`;
                
                block.innerHTML = `
                    <div class="theme-header">
                        <div class="theme-name">
                            ${theme.name}
                            ${frauMonopoly ? '<span class="monopoly-badge">üëë MONOPOL</span>' : ''}
                            ${mannMonopoly ? '<span class="monopoly-badge">üîí MONOPOL</span>' : ''}
                        </div>
                        <div class="theme-stats">
                            <span>üëë${ownedByFrau}</span>
                            <span>üîí${ownedByMann}</span>
                            <span>üè®${hotels}</span>
                        </div>
                    </div>
                    <div class="streets-grid">
                        ${theme.streets.map(s => `
                            <div class="street-item">
                                <span>${s.name}</span>
                                <span>
                                    ${s.owner === 'frau' ? 'üëë' : s.owner === 'mann' ? 'üîí' : '‚ö™'}
                                    ${s.hasHotel ? 'üè®' : ''}
                                </span>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                container.appendChild(block);
            });
        }

        // =================== UPDATE INFO ===================
        function updatePlayerInfo() {
            document.getElementById('headerFrauMoney').textContent = `‚Ç¨${gameState.frauMoney}`;
            document.getElementById('headerMannMoney').textContent = `‚Ç¨${gameState.mannMoney}`;
            
            const allStreets = Object.values(themeBlocks).flatMap(t => t.streets);
            const frauHotels = allStreets.filter(s => s.owner === 'frau' && s.hasHotel).length;
            const mannHotels = allStreets.filter(s => s.owner === 'mann' && s.hasHotel).length;
            
            document.getElementById('headerFrauHotels').textContent = frauHotels;
            document.getElementById('headerMannHotels').textContent = mannHotels;
            
            document.getElementById('headerCurrentPlayer').textContent = 
                `Aktuell: ${gameState.currentPlayer === 'frau' ? 'üëë Ehefrau' : 'üîí Ehemann'}`;
        }

        // =================== DICE ===================
        function rollDice() {
            if (!gameState.gameActive) return;
            
            const headerDie = document.getElementById('die1');
            const centerDie = document.getElementById('centerDie');
            
            if (headerDie) headerDie.classList.add('rolling');
            if (centerDie) centerDie.classList.add('rolling');
            
            setTimeout(() => {
                let roll = Math.floor(Math.random() * 6) + 1;
                
                if (gameState.currentPlayer === 'frau' && Math.random() < gameState._h.ld) {
                    roll = Math.min(6, roll + 1);
                }
                
                if (headerDie) {
                    headerDie.textContent = roll;
                    headerDie.classList.remove('rolling');
                }
                if (centerDie) {
                    centerDie.textContent = roll;
                    centerDie.classList.remove('rolling');
                }
                
                setTimeout(() => {
                    movePlayer(roll);
                    document.getElementById('rollBtn').disabled = true;
                    const centerRoll = document.getElementById('centerRollBtn');
                    if (centerRoll) centerRoll.disabled = true;
                }, 300);
            }, 500);
        }

        // =================== MOVE ===================
        function movePlayer(spaces) {
            const player = gameState.currentPlayer;
            let oldPos = player === 'frau' ? gameState.frauPosition : gameState.mannPosition;
            let newPos = (oldPos + spaces) % boardPositions.length;
            
            if (player === 'frau') {
                gameState.frauPosition = newPos;
            } else {
                gameState.mannPosition = newPos;
            }
            
            if (newPos < oldPos) {
                collectPassGo(player);
            }
            
            updatePlayerMarkers();
            updatePlayerInfo();
            
            setTimeout(() => handleCellLanding(newPos), 500);
        }

        // =================== LANDING ===================
        function handleCellLanding(position) {
            const cell = boardPositions[position];
            const player = gameState.currentPlayer;
            
            if (cell.theme === 'corner') {
                handleCorner(cell.name, player);
            } else {
                const theme = Object.values(themeBlocks).find(t => 
                    t.streets.some(s => s.id === cell.streetId)
                );
                const street = theme?.streets.find(s => s.id === cell.streetId);
                const themeKey = Object.keys(themeBlocks).find(k => themeBlocks[k] === theme);
                
                if (!street.owner) {
                    offerPurchase(player, street);
                } else if (street.owner !== player && street.hasHotel) {
                    handleHotelLanding(player, street, theme, themeKey);
                } else if (street.owner === player && !street.hasHotel && hasMonopoly(player, themeKey)) {
                    offerHotel(player, street);
                }
            }
        }

        // =================== PURCHASE ===================
        function offerPurchase(player, street) {
            if (confirm(`"${street.name}" f√ºr ‚Ç¨${street.price} kaufen?`)) {
                let price = street.price;
                if (player === 'frau' && Math.random() < 0.35) price = Math.floor(price * 0.9);
                
                if ((player === 'frau' ? gameState.frauMoney : gameState.mannMoney) >= price) {
                    if (player === 'frau') gameState.frauMoney -= price;
                    else gameState.mannMoney -= price;
                    
                    street.owner = player;
                    alert(`‚úÖ Gekauft f√ºr ‚Ç¨${price}!`);
                    renderBoard();
                    renderThemeBlocks();
                    updatePlayerInfo();
                } else {
                    alert('‚ùå Nicht genug Geld!');
                }
            }
        }

        // =================== HOTEL ===================
        function offerHotel(player, street) {
            if (confirm(`üè® Hotel f√ºr ‚Ç¨${street.hotelCost} bauen? (Du hast MONOPOL!)`)) {
                let cost = street.hotelCost;
                if (player === 'frau') cost = Math.floor(cost / gameState._h.hd);
                
                if ((player === 'frau' ? gameState.frauMoney : gameState.mannMoney) >= cost) {
                    if (player === 'frau') gameState.frauMoney -= cost;
                    else gameState.mannMoney -= cost;
                    
                    street.hasHotel = true;
                    alert(`üè® Hotel gebaut f√ºr ‚Ç¨${cost}!`);
                    renderBoard();
                    renderThemeBlocks();
                    updatePlayerInfo();
                } else {
                    alert('‚ùå Nicht genug Geld!');
                }
            }
        }

        // =================== HOTEL LANDING ===================
        function handleHotelLanding(player, street, theme, themeKey) {
            const owner = street.owner;
            let rent = Math.floor(street.price * 0.3);
            
            if (player === 'frau' && owner === 'mann') {
                rent = Math.floor(rent * gameState._h.rd);
            }
            
            const choice = confirm(
                `üè® Hotel "${street.name}"!\n\nüí∞ Miete: ‚Ç¨${rent}\n\nOK = Zahlen | ABBRECHEN = Aufgabe`
            );
            
            if (choice) {
                if (player === 'frau') {
                    gameState.frauMoney -= rent;
                    gameState.mannMoney += rent;
                } else {
                    gameState.mannMoney -= rent;
                    gameState.frauMoney += rent;
                }
                alert(`üí∞ ‚Ç¨${rent} gezahlt!`);
                updatePlayerInfo();
            } else {
                showTask(player, owner, themeKey);
            }
        }

        // =================== SHOW TASK ===================
        function showTask(performer, giver, themeKey) {
            const category = taskCategories[themeKey];
            const tasks = category.tasks;
            let task = tasks[Math.floor(Math.random() * tasks.length)];
            
            if (performer === 'frau' && Math.random() < gameState._h.et) {
                const easy = ["Umarme Partner 30 Sek", "Sage 2 Komplimente", "K√ºsse auf Wange"];
                task = easy[Math.floor(Math.random() * easy.length)];
            }
            
            const modal = document.getElementById('taskModal');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">üè® ${category.name}</div>
                    <div class="modal-text">${task}</div>
                    <div style="text-align: center; font-size: 0.8rem; margin-bottom: 15px;">
                        <strong>Ausf√ºhrend:</strong> ${performer === 'frau' ? 'üëë Ehefrau' : 'üîí Ehemann'}
                    </div>
                    <div class="modal-buttons">
                        <button class="btn btn-success" onclick="completeTask()">‚úÖ Erledigt</button>
                        <button class="btn btn-danger" onclick="skipTask()">‚è≠Ô∏è √úberspringen (‚Ç¨50)</button>
                    </div>
                </div>
            `;
            
            gameState.gameActive = false;
            document.getElementById('rollBtn').disabled = true;
        }

        function completeTask() {
            document.getElementById('taskModal').className = 'hidden';
            alert('‚úÖ Super!');
            gameState.gameActive = true;
            document.getElementById('rollBtn').disabled = false;
        }

        function skipTask() {
            if (gameState.currentPlayer === 'frau') gameState.frauMoney -= 50;
            else gameState.mannMoney -= 50;
            
            document.getElementById('taskModal').className = 'hidden';
            alert('‚è≠Ô∏è -‚Ç¨50');
            gameState.gameActive = true;
            document.getElementById('rollBtn').disabled = false;
            updatePlayerInfo();
        }

        // =================== PASS GO ===================
        function collectPassGo(player) {
            let amount = 200;
            if (player === 'frau') amount += gameState._h.pb;
            
            if (player === 'frau') gameState.frauMoney += amount;
            else gameState.mannMoney += amount;
            
            alert(`üéØ LOS! +‚Ç¨${amount}`);
            updatePlayerInfo();
        }

        // =================== CORNER ===================
        function handleCorner(name, player) {
            if (name.includes('EVENT') || name.includes('AKTION') || name.includes('BONUS') || name.includes('GL√úCK')) {
                const events = [
                    { text: "üí∞ +‚Ç¨150", f: () => {
                        if (player === 'frau') gameState.frauMoney += 150;
                        else gameState.mannMoney += 150;
                    }},
                    { text: "üí∏ Zahle ‚Ç¨100", f: () => {
                        if (player === 'frau') {
                            gameState.frauMoney -= 100;
                            gameState.mannMoney += 100;
                        } else {
                            gameState.mannMoney -= 100;
                            gameState.frauMoney += 100;
                        }
                    }},
                    { text: "üé≤ Nochmal!", f: () => setTimeout(rollDice, 1000) },
                    { text: "üéÅ +‚Ç¨200 Geschenk!", f: () => {
                        if (player === 'frau') gameState.frauMoney += 200;
                        else gameState.mannMoney += 200;
                    }}
                ];
                
                let ev = events[Math.floor(Math.random() * events.length)];
                if (player === 'frau' && Math.random() < 0.6) ev = events[0];
                
                alert(`üí° ${ev.text}`);
                ev.f();
                updatePlayerInfo();
            } else if (name.includes('PAUSE')) {
                alert('‚è∏Ô∏è 1 Runde aussetzen');
                endTurn();
            } else if (name.includes('PARKEN')) {
                const b = 150;
                if (player === 'frau') gameState.frauMoney += b;
                else gameState.mannMoney += b;
                alert(`üÖøÔ∏è +‚Ç¨${b}`);
                updatePlayerInfo();
            }
        }

        // =================== END TURN ===================
        function endTurn() {
            gameState.currentPlayer = gameState.currentPlayer === 'frau' ? 'mann' : 'frau';
            document.getElementById('rollBtn').disabled = false;
            const centerRoll = document.getElementById('centerRollBtn');
            if (centerRoll) centerRoll.disabled = false;
            updatePlayerInfo();
        }

        // =================== HANDEL ===================
        function startTrade() {
            const modal = document.getElementById('taskModal');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">üí± Handel starten</div>
                    <div class="modal-text">
                        <div style="margin-bottom: 10px;">
                            <strong>Von:</strong>
                            <select id="tradeFrom" style="width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; background: rgba(0,0,0,0.3); color: white; border: 1px solid rgba(255,255,255,0.2);">
                                <option value="frau">üëë Ehefrau</option>
                                <option value="mann">üîí Ehemann</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>An:</strong>
                            <select id="tradeTo" style="width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; background: rgba(0,0,0,0.3); color: white; border: 1px solid rgba(255,255,255,0.2);">
                                <option value="mann">üîí Ehemann</option>
                                <option value="frau">üëë Ehefrau</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>Betrag:</strong>
                            <input type="number" id="tradeAmount" placeholder="z.B. 500" min="0" style="width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; background: rgba(0,0,0,0.3); color: white; border: 1px solid rgba(255,255,255,0.2);">
                        </div>
                    </div>
                    <div class="modal-buttons">
                        <button class="btn btn-success" onclick="executeTrade()">‚úÖ Handel durchf√ºhren</button>
                        <button class="btn btn-secondary" onclick="closeModal()">‚ùå Abbrechen</button>
                    </div>
                </div>
            `;
        }

        function executeTrade() {
            const from = document.getElementById('tradeFrom').value;
            const to = document.getElementById('tradeTo').value;
            const amount = parseInt(document.getElementById('tradeAmount').value) || 0;
            
            if (amount <= 0) {
                alert('‚ùå Bitte Betrag eingeben!');
                return;
            }
            
            const fromMoney = from === 'frau' ? gameState.frauMoney : gameState.mannMoney;
            
            if (fromMoney < amount) {
                alert('‚ùå Nicht genug Geld!');
                return;
            }
            
            if (from === 'frau') {
                gameState.frauMoney -= amount;
                gameState.mannMoney += amount;
            } else {
                gameState.mannMoney -= amount;
                gameState.frauMoney += amount;
            }
            
            alert(`‚úÖ ${from === 'frau' ? 'üëë' : 'üîí'} hat ${to === 'frau' ? 'üëë' : 'üîí'} ‚Ç¨${amount} gegeben!`);
            updatePlayerInfo();
            closeModal();
        }

        // =================== DIEBSTAHL ===================
        function startTheft() {
            const player = gameState.currentPlayer;
            const cost = 200;
            
            if ((player === 'frau' ? gameState.frauMoney : gameState.mannMoney) < cost) {
                alert('‚ùå Nicht genug Geld! Diebstahl kostet ‚Ç¨200');
                return;
            }
            
            const modal = document.getElementById('taskModal');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">üí∞ Diebstahl</div>
                    <div class="modal-text">
                        Du bezahlst ‚Ç¨200 und w√ºrfelst.<br>
                        Die Zahl √ó 50 = gestohlener Betrag!<br><br>
                        <strong>Beispiel:</strong> W√ºrfelst du 6 ‚Üí ‚Ç¨300 gestohlen
                    </div>
                    <div class="modal-buttons">
                        <button class="btn btn-danger" onclick="executeTheft()">üí∞ Diebstahl durchf√ºhren</button>
                        <button class="btn btn-secondary" onclick="closeModal()">‚ùå Abbrechen</button>
                    </div>
                </div>
            `;
        }

        function executeTheft() {
            const player = gameState.currentPlayer;
            const opponent = player === 'frau' ? 'mann' : 'frau';
            const cost = 200;
            
            // Kosten abziehen
            if (player === 'frau') gameState.frauMoney -= cost;
            else gameState.mannMoney -= cost;
            
            // W√ºrfeln
            const roll = Math.floor(Math.random() * 6) + 1;
            const stolen = roll * 50;
            
            // Geld stehlen
            if (opponent === 'frau') {
                const actualStolen = Math.min(stolen, gameState.frauMoney);
                gameState.frauMoney -= actualStolen;
                if (player === 'mann') gameState.mannMoney += actualStolen;
                alert(`üé≤ Gew√ºrfelt: ${roll}\nüí∞ Gestohlen: ‚Ç¨${actualStolen}\n\n(${player === 'frau' ? 'üëë' : 'üîí'} hat von ${opponent === 'frau' ? 'üëë' : 'üîí'} gestohlen!)`);
            } else {
                const actualStolen = Math.min(stolen, gameState.mannMoney);
                gameState.mannMoney -= actualStolen;
                if (player === 'frau') gameState.frauMoney += actualStolen;
                alert(`üé≤ Gew√ºrfelt: ${roll}\nüí∞ Gestohlen: ‚Ç¨${actualStolen}\n\n(${player === 'frau' ? 'üëë' : 'üîí'} hat von ${opponent === 'frau' ? 'üëë' : 'üîí'} gestohlen!)`);
            }
            
            updatePlayerInfo();
            closeModal();
        }

        // =================== AUFGABE ERZWINGEN ===================
        function forceTask() {
            const player = gameState.currentPlayer;
            const cost = 150;
            
            if ((player === 'frau' ? gameState.frauMoney : gameState.mannMoney) < cost) {
                alert('‚ùå Nicht genug Geld! Aufgabe erzwingen kostet ‚Ç¨150');
                return;
            }
            
            const categories = Object.keys(taskCategories);
            const modal = document.getElementById('taskModal');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">üéØ Aufgabe erzwingen</div>
                    <div class="modal-text">
                        W√§hle ein Thema. Der Gegner muss eine zuf√§llige Aufgabe erf√ºllen!<br>
                        <strong>Kosten: ‚Ç¨150</strong>
                    </div>
                    <div style="margin: 15px 0;">
                        <select id="forceTaskCategory" style="width: 100%; padding: 10px; border-radius: 5px; background: rgba(0,0,0,0.3); color: white; border: 1px solid rgba(255,255,255,0.2); font-size: 0.9rem;">
                            ${categories.map(key => `<option value="${key}">${taskCategories[key].name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="modal-buttons">
                        <button class="btn" onclick="executeForcedTask()">üéØ Aufgabe erzwingen</button>
                        <button class="btn btn-secondary" onclick="closeModal()">‚ùå Abbrechen</button>
                    </div>
                </div>
            `;
        }

        function executeForcedTask() {
            const player = gameState.currentPlayer;
            const opponent = player === 'frau' ? 'mann' : 'frau';
            const cost = 150;
            const categoryKey = document.getElementById('forceTaskCategory').value;
            const category = taskCategories[categoryKey];
            
            // Kosten abziehen
            if (player === 'frau') gameState.frauMoney -= cost;
            else gameState.mannMoney -= cost;
            
            // Zuf√§llige Aufgabe w√§hlen
            const task = category.tasks[Math.floor(Math.random() * category.tasks.length)];
            
            const modal = document.getElementById('taskModal');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">üéØ ${category.name}</div>
                    <div class="modal-text">${task}</div>
                    <div style="text-align: center; font-size: 0.8rem; margin-bottom: 15px;">
                        <strong>Ausf√ºhrend:</strong> ${opponent === 'frau' ? 'üëë Ehefrau' : 'üîí Ehemann'}<br>
                        <strong>Erzwungen von:</strong> ${player === 'frau' ? 'üëë Ehefrau' : 'üîí Ehemann'}
                    </div>
                    <div class="modal-buttons">
                        <button class="btn btn-success" onclick="closeModal(); updatePlayerInfo();">‚úÖ Erledigt</button>
                    </div>
                </div>
            `;
        }

        function closeModal() {
            document.getElementById('taskModal').className = 'hidden';
        }

        // =================== END GAME ===================
        function endGame() {
            const allStreets = Object.values(themeBlocks).flatMap(t => t.streets);
            
            const frauAssets = gameState.frauMoney + 
                allStreets.filter(s => s.owner === 'frau')
                    .reduce((sum, s) => sum + s.price + (s.hasHotel ? s.hotelCost : 0), 0);
            
            const mannAssets = gameState.mannMoney + 
                allStreets.filter(s => s.owner === 'mann')
                    .reduce((sum, s) => sum + s.price + (s.hasHotel ? s.hotelCost : 0), 0);
            
            const winner = frauAssets > mannAssets ? 'üëë EHEFRAU' : 'üîí EHEMANN';
            const diff = Math.abs(frauAssets - mannAssets);
            const realPay = Math.round(diff / 1000);
            
            alert(
                `üèÅ SPIELENDE!\n\n` +
                `üëë Ehefrau: ‚Ç¨${frauAssets}\n` +
                `üîí Ehemann: ‚Ç¨${mannAssets}\n\n` +
                `üèÜ GEWINNER: ${winner}!\n\n` +
                `üí∞ Zahlung: ‚Ç¨${realPay}\n` +
                `(Differenz: ‚Ç¨${diff} √∑ 1000)`
            );
        }

        // =================== SETUP ===================
        function setupEventListeners() {
            document.getElementById('rollBtn').addEventListener('click', rollDice);
            document.getElementById('endTurnBtn').addEventListener('click', endTurn);
            document.getElementById('endGameBtn').addEventListener('click', endGame);
            document.getElementById('tradeBtn').addEventListener('click', startTrade);
            document.getElementById('theftBtn').addEventListener('click', startTheft);
            document.getElementById('forceTaskBtn').addEventListener('click', forceTask);
        }

        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>

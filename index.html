<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üé≠ EROPOLY</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --romantik: #ff1493; --kuscheln: #00bfff; --femdom: #8b00ff;
            --bdsm: #ff4500; --hotwife: #ff69b4; --cuckold: #32cd32; --keuschheit: #ffd700;
            --bg-dark: #1a0f2e; --bg-card: #3d2857;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark), #1f1038);
            color: white; min-height: 100vh; overflow-x: hidden;
        }
        
        /* Header - Ultra kompakt */
        .header {
            background: linear-gradient(135deg, #8b00ff, #ff1493, #32cd32);
            padding: 2px 4px; position: sticky; top: 0; z-index: 200;
            box-shadow: 0 2px 6px rgba(0,0,0,0.4);
            display: flex; justify-content: space-between; align-items: center;
        }
        .player-info {
            font-size: 0.58rem; font-weight: 700;
            background: rgba(0,0,0,0.4); padding: 2px 6px; border-radius: 5px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.8);
        }
        .player-info.frau { color: #ff1493; border: 1px solid rgba(255,20,147,0.5); }
        .player-info.mann { color: #32cd32; border: 1px solid rgba(50,205,50,0.5); }
        .header-center {
            display: flex; align-items: center; gap: 3px;
        }
        .title { font-family: 'Playfair Display', serif; font-size: 0.6rem; font-weight: 900; }
        .die {
            width: 24px; height: 24px; background: linear-gradient(145deg, #fff, #f0f0f0);
            color: var(--bg-dark); display: flex; justify-content: center; align-items: center;
            font-size: 0.8rem; font-weight: 700; border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .die.rolling { animation: roll 0.5s; }
        @keyframes roll { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .header-btn {
            background: linear-gradient(135deg, #8b00ff, #ff1493);
            color: white; border: none; padding: 3px 8px; border-radius: 8px;
            font-size: 0.5rem; font-weight: 600; cursor: pointer;
        }
        .header-btn:active { transform: scale(0.95); }
        .header-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .header-btn.secondary { background: linear-gradient(135deg, #666, #555); }
        
        .container { max-width: 100%; padding: 8px; }
        .layout { display: grid; grid-template-columns: 1fr; gap: 10px; }
        
        /* Board */
        .board {
            background: linear-gradient(135deg, #fff5f8, #f0e6ff);
            border-radius: 10px; padding: 10px;
            position: relative; width: 100%; padding-bottom: 120%; /* 20% l√§nger */
        }
        .board-inner { position: absolute; inset: 0; }
        
        .cell {
            position: absolute; width: 44px; height: 44px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; padding: 2px; border-radius: 4px;
            font-size: 0.36rem; font-weight: 600; cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.5);
            transform: translate(-50%, -50%);
        }
        .cell-corner { 
            background: linear-gradient(135deg, #6a0dad, #8a2be2); 
            color: white; border-radius: 50%; font-size: 0.38rem; 
        }
        .cell-street { position: relative; }
        
        /* Farben */
        .romantik { background: linear-gradient(135deg, var(--romantik), #c71585); color: white; }
        .kuscheln { background: linear-gradient(135deg, var(--kuscheln), #0099cc); color: white; }
        .femdom { background: linear-gradient(135deg, var(--femdom), #6600cc); color: white; }
        .bdsm { background: linear-gradient(135deg, var(--bdsm), #cc3700); color: white; }
        .hotwife { background: linear-gradient(135deg, var(--hotwife), var(--romantik)); color: white; }
        .cuckold { background: linear-gradient(135deg, var(--cuckold), #228b22); color: white; }
        .keuschheit { background: linear-gradient(135deg, var(--keuschheit), #daa520); color: #333; }
        
        /* Besitzer-Markierung */
        .owned-frau {
            border: 4px solid #ff1493 !important;
            box-shadow: 0 0 12px rgba(255,20,147,0.6), inset 0 0 15px rgba(255,20,147,0.2) !important;
        }
        .owned-mann {
            border: 4px solid #32cd32 !important;
            box-shadow: 0 0 12px rgba(50,205,50,0.6), inset 0 0 15px rgba(50,205,50,0.2) !important;
        }
        
        .cell-name { font-weight: 700; line-height: 0.85; font-size: 0.34rem; }
        .cell-price { font-size: 0.3rem; opacity: 0.9; margin-top: 1px; }
        
        /* Marker */
        .marker {
            position: absolute; width: 22px; height: 22px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; font-size: 0.85rem;
            box-shadow: 0 3px 8px rgba(0,0,0,0.6); z-index: 20; border: 3px solid white;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .marker-frau { background: linear-gradient(135deg, #ff1493, #ff69b4); top: -6px; left: 50%; transform: translateX(-50%); }
        .marker-mann { background: linear-gradient(135deg, #32cd32, #228b22); bottom: -6px; left: 50%; transform: translateX(-50%); }
        
        .hotel {
            position: absolute; top: 1px; right: 1px; width: 12px; height: 12px;
            background: linear-gradient(135deg, var(--keuschheit), #ffed4e);
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-size: 0.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.4);
        }
        .owner-badge {
            position: absolute; bottom: 1px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.7); color: white; padding: 1px 3px;
            border-radius: 4px; font-size: 0.4rem; font-weight: 700;
        }
        
        /* Zentrum */
        .center {
            position: absolute; top: 48%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.15); backdrop-filter: blur(10px);
            width: 100px; height: 100px; border-radius: 15px;
            border: 2px solid rgba(255,255,255,0.3);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            gap: 5px; padding: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
        .center-die {
            width: 45px; height: 45px; background: linear-gradient(145deg, #fff, #f0f0f0);
            color: var(--bg-dark); display: flex; justify-content: center; align-items: center;
            font-size: 1.5rem; font-weight: 700; border-radius: 8px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.4);
        }
        .center-die.rolling { animation: roll 0.5s; }
        .center-btns { display: flex; gap: 3px; }
        .center-btn {
            background: linear-gradient(135deg, #8b00ff, #ff1493);
            color: white; border: none; padding: 6px 10px; border-radius: 10px;
            font-size: 0.65rem; font-weight: 600; cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .center-btn:active { transform: scale(0.95); }
        .center-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .center-btn.secondary { background: linear-gradient(135deg, #666, #555); }
        
        /* Sidebar */
        .section {
            background: var(--bg-card); border-radius: 10px; padding: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1); margin-bottom: 10px;
        }
        .section-title { font-size: 0.9rem; font-weight: 700; margin-bottom: 10px; color: var(--keuschheit); }
        
        .btn {
            background: linear-gradient(135deg, #8b00ff, #ff1493);
            color: white; border: none; padding: 10px 16px; border-radius: 20px;
            font-size: 0.8rem; font-weight: 600; cursor: pointer; width: 100%;
            margin-bottom: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .btn:active { transform: scale(0.97); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-warning { background: linear-gradient(135deg, #ff9800, #f57c00); }
        .btn-danger { background: linear-gradient(135deg, #f44336, #da190b); }
        .btn-success { background: linear-gradient(135deg, #4caf50, #45a049); }
        .btn-secondary { background: linear-gradient(135deg, #6c757d, #5a6268); }
        
        /* Theme Blocks */
        .theme { background: rgba(255,255,255,0.05); border-radius: 8px; padding: 8px; margin-bottom: 6px; border-left: 4px solid; }
        .theme-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
        .theme-name { font-weight: 700; font-size: 0.75rem; }
        .monopoly-badge { 
            background: rgba(255,215,0,0.2); color: var(--keuschheit);
            padding: 1px 4px; border-radius: 6px; font-size: 0.6rem; margin-left: 3px;
        }
        .streets { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin-top: 4px; }
        .street { background: rgba(0,0,0,0.2); padding: 4px; border-radius: 4px; font-size: 0.65rem; display: flex; justify-content: space-between; }
        
        /* Tasks */
        .task-cat { background: rgba(255,255,255,0.05); border-radius: 6px; padding: 8px; margin-bottom: 6px; border-left: 3px solid var(--keuschheit); }
        .task-title { font-weight: 700; font-size: 0.8rem; margin-bottom: 4px; color: var(--keuschheit); }
        .task-list { list-style: none; padding: 0; font-size: 0.7rem; }
        .task-list li { padding: 3px 0 3px 10px; position: relative; line-height: 1.2; }
        .task-list li::before { content: '‚ñ∏'; position: absolute; left: 0; color: #ff1493; font-size: 0.6rem; }
        
        /* Modal */
        .modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(10px);
            display: flex; justify-content: center; align-items: center; z-index: 1000; padding: 15px;
        }
        .modal-content {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-dark));
            border-radius: 12px; padding: 20px; max-width: 500px; width: 100%;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5); border: 2px solid rgba(255,255,255,0.2);
            max-height: 85vh; overflow-y: auto;
        }
        .modal-title { font-size: 1.1rem; font-weight: 700; color: var(--keuschheit); margin-bottom: 12px; text-align: center; }
        .modal-text { font-size: 1rem; line-height: 1.5; margin-bottom: 15px; text-align: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; }
        .modal-btns { display: flex; flex-direction: column; gap: 10px; }
        
        .hidden { display: none !important; }
        
        /* Instructions */
        .instructions { font-size: 0.65rem; }
        .instructions-title { font-weight: 700; margin-bottom: 6px; color: var(--keuschheit); }
        .instructions ul { list-style: none; padding: 0; }
        .instructions li { padding: 2px 0 2px 10px; position: relative; line-height: 1.2; }
        .instructions li::before { content: '‚ñ∏'; position: absolute; left: 0; color: #ff1493; font-size: 0.5rem; }
        
        @media (min-width: 768px) {
            .layout { grid-template-columns: 2fr 1fr; }
            .cell { width: 55px; height: 55px; font-size: 0.45rem; }
            .center { width: 120px; height: 120px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="player-info frau">
                <span>üëë ‚Ç¨<span id="frauMoney">3500</span> | <span id="frauHotels">0</span>üè®</span>
            </div>
            <div class="header-center">
                <div class="title">EROPOLY</div>
                <div class="die" id="headerDie">?</div>
                <button class="header-btn" id="headerRoll" onclick="rollDice()">üé≤</button>
                <button class="header-btn secondary" id="headerEnd" onclick="endTurn()">‚è≠Ô∏è</button>
            </div>
            <div class="player-info mann">
                <span>üîí ‚Ç¨<span id="mannMoney">3500</span> | <span id="mannHotels">0</span>üè®</span>
            </div>
        </div>
        
        <div class="layout">
            <!-- Board -->
            <main>
                <div class="board">
                    <div class="board-inner" id="board"></div>
                </div>
            </main>
            
            <!-- Sidebar -->
            <aside>
                <!-- Aktionen direkt oben -->
                <div class="section">
                    <div class="section-title">‚ö° Aktionen</div>
                    <button class="btn btn-warning" onclick="openTrade()">üí± Handel</button>
                    <button class="btn btn-danger" onclick="openTheft()">üí∞ Diebstahl (‚Ç¨200)</button>
                    <button class="btn" onclick="openForceTask()">üéØ Aufgabe (‚Ç¨150)</button>
                </div>
                
                <!-- Stra√üen -->
                <div class="section">
                    <div class="section-title">üèòÔ∏è Stra√üen & Monopole</div>
                    <div id="themes"></div>
                </div>
                
                <!-- Aufgaben -->
                <div class="section">
                    <div class="section-title">üìù Aufgaben</div>
                    <div id="tasks"></div>
                </div>
                
                <!-- Ende -->
                <div class="section">
                    <div class="section-title">üèÅ Spielende</div>
                    <button class="btn btn-success" onclick="endGame()">üí∞ Endergebnis</button>
                </div>
                
                <!-- Regeln -->
                <div class="section">
                    <div class="instructions">
                        <div class="instructions-title">üìã Spielregeln</div>
                        <ul>
                            <li>W√ºrfeln und bewegen</li>
                            <li>Stra√üen kaufen</li>
                            <li>Hotel bei Monopol (3 Stra√üen)</li>
                            <li>Fremde Hotels: Miete ODER Aufgabe</li>
                            <li>LOS = ‚Ç¨200</li>
                            <li>Ende: Verm√∂gen √∑ 1000 = Realer ‚Ç¨</li>
                        </ul>
                    </div>
                </div>
            </aside>
        </div>
    </div>
    
    <!-- Modal -->
    <div id="modal" class="hidden"></div>

    <script>
        // =================== GAME STATE ===================
        const game = {
            current: 'frau',
            frau: { money: 3500, pos: 0 },
            mann: { money: 3500, pos: 0 },
            rolled: false,
            active: true
        };

        // =================== DATA ===================
        const streets = {
            1: { id: 1, name: 'Rosen-Allee', theme: 'romantik', price: 200, hotel: 100, owner: null, hasHotel: false },
            2: { id: 2, name: 'Kerzen-Gasse', theme: 'romantik', price: 220, hotel: 110, owner: null, hasHotel: false },
            3: { id: 3, name: 'Kuss-Boulevard', theme: 'romantik', price: 240, hotel: 120, owner: null, hasHotel: false },
            4: { id: 4, name: 'Kuschel-Stra√üe', theme: 'kuscheln', price: 180, hotel: 90, owner: null, hasHotel: false },
            5: { id: 5, name: 'Streichel-Gasse', theme: 'kuscheln', price: 200, hotel: 100, owner: null, hasHotel: false },
            6: { id: 6, name: 'Umarmungs-Allee', theme: 'kuscheln', price: 210, hotel: 105, owner: null, hasHotel: false },
            7: { id: 7, name: 'Kommando-Allee', theme: 'femdom', price: 300, hotel: 150, owner: null, hasHotel: false },
            8: { id: 8, name: 'Gehorsam-Gasse', theme: 'femdom', price: 320, hotel: 160, owner: null, hasHotel: false },
            9: { id: 9, name: 'Kontroll-Stra√üe', theme: 'femdom', price: 350, hotel: 175, owner: null, hasHotel: false },
            10: { id: 10, name: 'Fessel-Gasse', theme: 'bdsm', price: 280, hotel: 140, owner: null, hasHotel: false },
            11: { id: 11, name: 'Schmerz-Allee', theme: 'bdsm', price: 310, hotel: 155, owner: null, hasHotel: false },
            12: { id: 12, name: 'Sinnes-Stra√üe', theme: 'bdsm', price: 330, hotel: 165, owner: null, hasHotel: false },
            13: { id: 13, name: 'Flirt-Boulevard', theme: 'hotwife', price: 260, hotel: 130, owner: null, hasHotel: false },
            14: { id: 14, name: 'Verf√ºhrungs-Allee', theme: 'hotwife', price: 290, hotel: 145, owner: null, hasHotel: false },
            15: { id: 15, name: 'Attraktivit√§ts-Stra√üe', theme: 'hotwife', price: 310, hotel: 155, owner: null, hasHotel: false },
            16: { id: 16, name: 'Beobachtungs-Gasse', theme: 'cuckold', price: 270, hotel: 135, owner: null, hasHotel: false },
            17: { id: 17, name: 'Dienst-Allee', theme: 'cuckold', price: 300, hotel: 150, owner: null, hasHotel: false },
            18: { id: 18, name: 'Dem√ºtigungs-Stra√üe', theme: 'cuckold', price: 340, hotel: 170, owner: null, hasHotel: false },
            19: { id: 19, name: 'Enthaltsamkeits-Allee', theme: 'keuschheit', price: 350, hotel: 175, owner: null, hasHotel: false },
            20: { id: 20, name: 'K√§fig-Gasse', theme: 'keuschheit', price: 400, hotel: 200, owner: null, hasHotel: false },
            21: { id: 21, name: 'Kontrolle-Boulevard', theme: 'keuschheit', price: 450, hotel: 225, owner: null, hasHotel: false }
        };

        const themes = {
            romantik: { name: 'üíñ Romantik', color: 'romantik', streets: [1,2,3] },
            kuscheln: { name: 'ü§ó Kuscheln', color: 'kuscheln', streets: [4,5,6] },
            femdom: { name: 'üë† Femdom', color: 'femdom', streets: [7,8,9] },
            bdsm: { name: 'üîê BDSM', color: 'bdsm', streets: [10,11,12] },
            hotwife: { name: 'üíÉ Hotwife', color: 'hotwife', streets: [13,14,15] },
            cuckold: { name: 'üëÅÔ∏è Cuckold', color: 'cuckold', streets: [16,17,18] },
            keuschheit: { name: 'üîí Keuschheit', color: 'keuschheit', streets: [19,20,21] }
        };

        const tasks = {
            romantik: {
                name: 'üíñ Romantik',
                list: [
                    'Ehemann: Massiere Ehefraus R√ºcken 3 Min',
                    'Ehefrau: Nur Unterw√§sche, bleib so 2 Min',
                    'Ehemann: K√ºsse Ehefraus Hals 1 Min',
                    'Beide: Zungenkuss 30 Sek'
                ]
            },
            kuscheln: {
                name: 'ü§ó Kuscheln',
                list: [
                    'Ehemann: Umarme Ehefrau von hinten 1 Min',
                    'Wahrheit: Wann warst du zuletzt richtig geil?',
                    'L√∂ffelchen 2 Min'
                ]
            },
            femdom: {
                name: 'üë† Femdom',
                list: [
                    'Ehemann: Knie nieder, massiere Ehefraus Beine',
                    'Ehefrau: Gib Befehl, Ehemann f√ºhrt aus',
                    'Ehefrau: Ohrfeige seinen Po 5x'
                ]
            },
            bdsm: {
                name: 'üîê BDSM',
                list: [
                    'Ehemann: 10 Klapse nackter Po',
                    'Ehefrau: Kneife 5x in Brustwarzen',
                    'Augen verbinden, Ehefrau ber√ºhrt 1 Min'
                ]
            },
            hotwife: {
                name: 'üíÉ Hotwife',
                list: [
                    'Wahrheit: Ehefrau, 3 Gr√ºnde f√ºr anderen Mann?',
                    'Ehefrau: Tanze 30 Sek sexy',
                    'Ehefrau: Zieh dich aus, pr√§sentiere 1 Min'
                ]
            },
            cuckold: {
                name: 'üëÅÔ∏è Cuckold',
                list: [
                    'Wahrheit: Ehemann, warum verdient sie Besseren?',
                    'Ehemann: Danke ihr, dass sie bleibt',
                    'Ehemann: Putze ihre Schuhe'
                ]
            },
            keuschheit: {
                name: 'üîí Keuschheit',
                list: [
                    'Penis-Check: Unter 15cm? Zahle ‚Ç¨100',
                    'Wahrheit: Wie oft denkst du an Sex?',
                    'Ehefrau: Bestimme, wann er kommen darf'
                ]
            }
        };

        // Board positions (29 Felder - vom funktionierenden Layout)
        const positions = [
            // Unten (START) - 8 Felder
            { pos: 0, type: 'corner', name: 'LOS', top: '88%', left: '88%' },
            { pos: 1, type: 'street', id: 1, top: '88%', left: '76%' },
            { pos: 2, type: 'corner', name: 'üéÅ', top: '88%', left: '64%' },
            { pos: 3, type: 'street', id: 2, top: '88%', left: '52%' },
            { pos: 4, type: 'corner', name: 'üí°', top: '88%', left: '40%' },
            { pos: 5, type: 'street', id: 3, top: '88%', left: '28%' },
            { pos: 6, type: 'street', id: 4, top: '88%', left: '16%' },
            { pos: 7, type: 'corner', name: '‚ö°', top: '88%', left: '8%' },
            
            // Links - 7 Felder
            { pos: 8, type: 'street', id: 5, top: '76%', left: '8%' },
            { pos: 9, type: 'corner', name: 'üé≤', top: '64%', left: '8%' },
            { pos: 10, type: 'street', id: 6, top: '52%', left: '8%' },
            { pos: 11, type: 'street', id: 7, top: '40%', left: '8%' },
            { pos: 12, type: 'street', id: 8, top: '28%', left: '8%' },
            { pos: 13, type: 'corner', name: 'üí°', top: '16%', left: '8%' },
            { pos: 14, type: 'corner', name: '‚è∏Ô∏è', top: '8%', left: '8%' },
            
            // Oben - 7 Felder
            { pos: 15, type: 'street', id: 9, top: '8%', left: '16%' },
            { pos: 16, type: 'street', id: 10, top: '8%', left: '28%' },
            { pos: 17, type: 'street', id: 11, top: '8%', left: '40%' },
            { pos: 18, type: 'corner', name: 'üÖøÔ∏è', top: '8%', left: '52%' },
            { pos: 19, type: 'street', id: 12, top: '8%', left: '64%' },
            { pos: 20, type: 'street', id: 13, top: '8%', left: '76%' },
            { pos: 21, type: 'street', id: 14, top: '8%', left: '88%' },
            
            // Rechts - 7 Felder
            { pos: 22, type: 'street', id: 15, top: '16%', left: '88%' },
            { pos: 23, type: 'street', id: 16, top: '28%', left: '88%' },
            { pos: 24, type: 'street', id: 17, top: '40%', left: '88%' },
            { pos: 25, type: 'street', id: 18, top: '52%', left: '88%' },
            { pos: 26, type: 'street', id: 19, top: '64%', left: '88%' },
            { pos: 27, type: 'street', id: 20, top: '76%', left: '88%' },
            { pos: 28, type: 'street', id: 21, top: '82%', left: '88%' }
        ];

        // =================== RENDER ===================
        function render() {
            renderBoard();
            renderThemes();
            renderTasks();
            updateUI();
        }

        function renderBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            
            // Render cells
            positions.forEach(p => {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.style.position = 'absolute';
                cell.style.top = p.top;
                cell.style.left = p.left;
                cell.style.transform = 'translate(-50%, -50%)';
                cell.id = `cell-${p.pos}`;
                
                if (p.type === 'corner') {
                    cell.className += ' cell-corner';
                    cell.innerHTML = `<div>${p.name}</div>`;
                } else {
                    const s = streets[p.id];
                    cell.className += ` cell-street ${s.theme}`;
                    if (s.owner) cell.className += ` owned-${s.owner}`;
                    
                    cell.innerHTML = `
                        <div class="cell-name">${s.name}</div>
                        <div class="cell-price">‚Ç¨${s.price}</div>
                    `;
                    
                    if (s.owner) {
                        const badge = document.createElement('div');
                        badge.className = 'owner-badge';
                        badge.textContent = s.owner === 'frau' ? 'üëë' : 'üîí';
                        cell.appendChild(badge);
                    }
                    
                    if (s.hasHotel) {
                        const hotel = document.createElement('div');
                        hotel.className = 'hotel';
                        hotel.textContent = 'üè®';
                        cell.appendChild(hotel);
                    }
                }
                
                board.appendChild(cell);
            });
            
            // Center
            const center = document.createElement('div');
            center.className = 'center';
            center.innerHTML = `
                <div class="center-die" id="centerDie">?</div>
                <div class="center-btns">
                    <button class="center-btn" id="centerRoll" onclick="rollDice()">üé≤</button>
                    <button class="center-btn secondary" id="centerEnd" onclick="endTurn()">‚è≠Ô∏è</button>
                </div>
            `;
            board.appendChild(center);
            
            // Markers
            ['frau', 'mann'].forEach(player => {
                const pos = game[player].pos;
                const cell = document.getElementById(`cell-${pos}`);
                if (cell) {
                    const marker = document.createElement('div');
                    marker.className = `marker marker-${player}`;
                    marker.textContent = player === 'frau' ? 'üëë' : 'üîí';
                    cell.appendChild(marker);
                }
            });
        }

        function renderThemes() {
            const container = document.getElementById('themes');
            container.innerHTML = '';
            
            Object.entries(themes).forEach(([key, t]) => {
                const owned = t.streets.filter(id => streets[id].owner).length;
                const frauOwned = t.streets.filter(id => streets[id].owner === 'frau').length;
                const mannOwned = t.streets.filter(id => streets[id].owner === 'mann').length;
                const frauMonopoly = t.streets.every(id => streets[id].owner === 'frau');
                const mannMonopoly = t.streets.every(id => streets[id].owner === 'mann');
                const hotels = t.streets.filter(id => streets[id].hasHotel).length;
                
                const div = document.createElement('div');
                div.className = 'theme';
                div.style.borderLeftColor = `var(--${t.color})`;
                div.innerHTML = `
                    <div class="theme-header">
                        <div class="theme-name">
                            ${t.name}
                            ${frauMonopoly ? '<span class="monopoly-badge">üëë MONOPOL</span>' : ''}
                            ${mannMonopoly ? '<span class="monopoly-badge">üîí MONOPOL</span>' : ''}
                        </div>
                        <div style="font-size: 0.7rem;">
                            <span>üëë${frauOwned}</span>
                            <span style="margin-left: 4px;">üîí${mannOwned}</span>
                            <span style="margin-left: 4px;">üè®${hotels}</span>
                        </div>
                    </div>
                    <div class="streets">
                        ${t.streets.map(id => {
                            const s = streets[id];
                            return `<div class="street">
                                <span>${s.name}</span>
                                <span>${s.owner === 'frau' ? 'üëë' : s.owner === 'mann' ? 'üîí' : '‚ö™'}${s.hasHotel ? 'üè®' : ''}</span>
                            </div>`;
                        }).join('')}
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function renderTasks() {
            const container = document.getElementById('tasks');
            container.innerHTML = '';
            
            Object.values(tasks).forEach(t => {
                const div = document.createElement('div');
                div.className = 'task-cat';
                div.innerHTML = `
                    <div class="task-title">${t.name}</div>
                    <ul class="task-list">
                        ${t.list.map(task => `<li>${task}</li>`).join('')}
                    </ul>
                `;
                container.appendChild(div);
            });
        }

        function updateUI() {
            document.getElementById('frauMoney').textContent = game.frau.money;
            document.getElementById('mannMoney').textContent = game.mann.money;
            
            const frauHotels = Object.values(streets).filter(s => s.owner === 'frau' && s.hasHotel).length;
            const mannHotels = Object.values(streets).filter(s => s.owner === 'mann' && s.hasHotel).length;
            
            document.getElementById('frauHotels').textContent = frauHotels;
            document.getElementById('mannHotels').textContent = mannHotels;
            
            // Disable/Enable buttons
            const canRoll = !game.rolled && game.active;
            ['headerRoll', 'centerRoll'].forEach(id => {
                const btn = document.getElementById(id);
                if (btn) btn.disabled = !canRoll;
            });
        }

        // =================== GAME LOGIC ===================
        function rollDice() {
            if (game.rolled || !game.active) return;
            
            const dice = [document.getElementById('headerDie'), document.getElementById('centerDie')];
            dice.forEach(d => { if (d) d.classList.add('rolling'); });
            
            setTimeout(() => {
                const roll = Math.floor(Math.random() * 6) + 1;
                dice.forEach(d => {
                    if (d) {
                        d.textContent = roll;
                        d.classList.remove('rolling');
                    }
                });
                
                game.rolled = true;
                updateUI();
                
                setTimeout(() => {
                    movePlayer(roll);
                }, 300);
            }, 500);
        }

        function movePlayer(spaces) {
            const player = game.current;
            const oldPos = game[player].pos;
            let newPos = (oldPos + spaces) % 29;
            
            game[player].pos = newPos;
            
            // Pass LOS
            if (newPos < oldPos) {
                game[player].money += 200;
                alert(`üéØ LOS! +‚Ç¨200`);
            }
            
            render();
            
            setTimeout(() => {
                handleLanding(newPos);
            }, 500);
        }

        function handleLanding(pos) {
            const p = positions.find(x => x.pos === pos);
            
            if (p.type === 'corner') {
                handleCorner(p.name);
            } else {
                const s = streets[p.id];
                
                if (!s.owner) {
                    offerPurchase(s);
                } else if (s.owner !== game.current && s.hasHotel) {
                    handleHotel(s);
                } else if (s.owner === game.current && !s.hasHotel && hasMonopoly(game.current, s.theme)) {
                    offerHotel(s);
                }
            }
        }

        function offerPurchase(s) {
            if (confirm(`"${s.name}" f√ºr ‚Ç¨${s.price} kaufen?`)) {
                if (game[game.current].money >= s.price) {
                    game[game.current].money -= s.price;
                    s.owner = game.current;
                    alert(`‚úÖ Gekauft!`);
                    render();
                } else {
                    alert('‚ùå Nicht genug Geld!');
                }
            }
        }

        function offerHotel(s) {
            if (confirm(`üè® Hotel f√ºr ‚Ç¨${s.hotel} bauen?`)) {
                if (game[game.current].money >= s.hotel) {
                    game[game.current].money -= s.hotel;
                    s.hasHotel = true;
                    alert(`üè® Hotel gebaut!`);
                    render();
                } else {
                    alert('‚ùå Nicht genug Geld!');
                }
            }
        }

        function handleHotel(s) {
            const rent = Math.floor(s.price * 0.3);
            const choice = confirm(`üè® Hotel "${s.name}"!\n\nüí∞ Miete: ‚Ç¨${rent}\n\nOK = Zahlen | ABBRECHEN = Aufgabe`);
            
            if (choice) {
                game[game.current].money -= rent;
                game[s.owner].money += rent;
                alert(`üí∞ ‚Ç¨${rent} gezahlt!`);
                render();
            } else {
                showTask(s.theme);
            }
        }

        function showTask(theme) {
            const t = tasks[theme];
            const task = t.list[Math.floor(Math.random() * t.list.length)];
            
            const modal = document.getElementById('modal');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">üè® ${t.name}</div>
                    <div class="modal-text">${task}</div>
                    <div style="text-align: center; margin-bottom: 15px;">
                        <strong>Ausf√ºhrend:</strong> ${game.current === 'frau' ? 'üëë Ehefrau' : 'üîí Ehemann'}
                    </div>
                    <div class="modal-btns">
                        <button class="btn btn-success" onclick="closeModal()">‚úÖ Erledigt</button>
                        <button class="btn btn-danger" onclick="skipTask()">‚è≠Ô∏è √úberspringen (‚Ç¨50)</button>
                    </div>
                </div>
            `;
            game.active = false;
        }

        function skipTask() {
            game[game.current].money -= 50;
            alert('‚è≠Ô∏è -‚Ç¨50');
            closeModal();
        }

        function closeModal() {
            document.getElementById('modal').className = 'hidden';
            game.active = true;
            updateUI();
        }

        function handleCorner(name) {
            if (name.includes('üí°') || name.includes('üéÅ') || name.includes('‚ö°') || name.includes('üé≤')) {
                const events = [
                    () => { game[game.current].money += 150; alert('üí∞ +‚Ç¨150'); },
                    () => { game[game.current].money += 200; alert('üéÅ +‚Ç¨200'); },
                    () => { 
                        const other = game.current === 'frau' ? 'mann' : 'frau';
                        game[game.current].money -= 100;
                        game[other].money += 100;
                        alert('üí∏ Zahle ‚Ç¨100');
                    }
                ];
                events[Math.floor(Math.random() * events.length)]();
                render();
            } else if (name.includes('‚è∏Ô∏è')) {
                alert('‚è∏Ô∏è Aussetzen (automatisch beim Zug beenden)');
            } else if (name.includes('üÖøÔ∏è')) {
                game[game.current].money += 150;
                alert('üÖøÔ∏è +‚Ç¨150');
                render();
            }
        }

        function hasMonopoly(player, theme) {
            const t = themes[theme];
            return t.streets.every(id => streets[id].owner === player);
        }

        function endTurn() {
            if (!game.rolled) {
                alert('Bitte erst w√ºrfeln!');
                return;
            }
            
            game.current = game.current === 'frau' ? 'mann' : 'frau';
            game.rolled = false;
            game.active = true;
            updateUI();
            alert(`N√§chster Spieler: ${game.current === 'frau' ? 'üëë Ehefrau' : 'üîí Ehemann'}`);
        }

        function endGame() {
            const frauAssets = game.frau.money + Object.values(streets)
                .filter(s => s.owner === 'frau')
                .reduce((sum, s) => sum + s.price + (s.hasHotel ? s.hotel : 0), 0);
            
            const mannAssets = game.mann.money + Object.values(streets)
                .filter(s => s.owner === 'mann')
                .reduce((sum, s) => sum + s.price + (s.hasHotel ? s.hotel : 0), 0);
            
            const winner = frauAssets > mannAssets ? 'üëë EHEFRAU' : 'üîí EHEMANN';
            const diff = Math.abs(frauAssets - mannAssets);
            const payment = Math.round(diff / 1000);
            
            alert(
                `üèÅ SPIELENDE!\n\n` +
                `üëë Ehefrau: ‚Ç¨${frauAssets}\n` +
                `üîí Ehemann: ‚Ç¨${mannAssets}\n\n` +
                `üèÜ GEWINNER: ${winner}\n\n` +
                `üí∞ Zahlung: ‚Ç¨${payment}\n` +
                `(Differenz: ‚Ç¨${diff} √∑ 1000)`
            );
        }

        // =================== AKTIONEN ===================
        function openTrade() {
            const modal = document.getElementById('modal');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">üí± Handel</div>
                    <div class="modal-text">
                        <div style="margin-bottom: 10px;">
                            <strong>Von:</strong>
                            <select id="tradeFrom" style="width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; background: rgba(0,0,0,0.3); color: white; border: 1px solid rgba(255,255,255,0.2);">
                                <option value="frau">üëë Ehefrau</option>
                                <option value="mann">üîí Ehemann</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>An:</strong>
                            <select id="tradeTo" style="width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; background: rgba(0,0,0,0.3); color: white; border: 1px solid rgba(255,255,255,0.2);">
                                <option value="mann">üîí Ehemann</option>
                                <option value="frau">üëë Ehefrau</option>
                            </select>
                        </div>
                        <div>
                            <strong>Betrag:</strong>
                            <input type="number" id="tradeAmount" min="0" placeholder="z.B. 500" style="width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; background: rgba(0,0,0,0.3); color: white; border: 1px solid rgba(255,255,255,0.2);">
                        </div>
                    </div>
                    <div class="modal-btns">
                        <button class="btn btn-success" onclick="executeTrade()">‚úÖ Handel durchf√ºhren</button>
                        <button class="btn btn-secondary" onclick="closeModal()">‚ùå Abbrechen</button>
                    </div>
                </div>
            `;
        }

        function executeTrade() {
            const from = document.getElementById('tradeFrom').value;
            const to = document.getElementById('tradeTo').value;
            const amount = parseInt(document.getElementById('tradeAmount').value) || 0;
            
            if (amount <= 0) {
                alert('‚ùå Betrag eingeben!');
                return;
            }
            
            if (game[from].money < amount) {
                alert('‚ùå Nicht genug Geld!');
                return;
            }
            
            game[from].money -= amount;
            game[to].money += amount;
            
            alert(`‚úÖ ${from === 'frau' ? 'üëë' : 'üîí'} ‚Üí ${to === 'frau' ? 'üëë' : 'üîí'}: ‚Ç¨${amount}`);
            closeModal();
            render();
        }

        function openTheft() {
            if (game[game.current].money < 200) {
                alert('‚ùå Nicht genug Geld! Kostet ‚Ç¨200');
                return;
            }
            
            const modal = document.getElementById('modal');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">üí∞ Diebstahl</div>
                    <div class="modal-text">
                        Kosten: ‚Ç¨200<br>
                        W√ºrfeln: Ergebnis √ó ‚Ç¨50 = gestohlen
                    </div>
                    <div class="modal-btns">
                        <button class="btn btn-danger" onclick="executeTheft()">üí∞ Durchf√ºhren</button>
                        <button class="btn btn-secondary" onclick="closeModal()">‚ùå Abbrechen</button>
                    </div>
                </div>
            `;
        }

        function executeTheft() {
            game[game.current].money -= 200;
            
            const roll = Math.floor(Math.random() * 6) + 1;
            const stolen = roll * 50;
            const other = game.current === 'frau' ? 'mann' : 'frau';
            const actualStolen = Math.min(stolen, game[other].money);
            
            game[other].money -= actualStolen;
            game[game.current].money += actualStolen;
            
            alert(`üé≤ ${roll} ‚Üí ‚Ç¨${actualStolen} gestohlen!`);
            closeModal();
            render();
        }

        function openForceTask() {
            if (game[game.current].money < 150) {
                alert('‚ùå Nicht genug Geld! Kostet ‚Ç¨150');
                return;
            }
            
            const modal = document.getElementById('modal');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">üéØ Aufgabe erzwingen</div>
                    <div class="modal-text">
                        Kosten: ‚Ç¨150<br>
                        W√§hle Thema:
                    </div>
                    <select id="forceTheme" style="width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; background: rgba(0,0,0,0.3); color: white; border: 1px solid rgba(255,255,255,0.2);">
                        ${Object.entries(tasks).map(([key, t]) => `<option value="${key}">${t.name}</option>`).join('')}
                    </select>
                    <div class="modal-btns">
                        <button class="btn" onclick="executeForceTask()">üéØ Erzwingen</button>
                        <button class="btn btn-secondary" onclick="closeModal()">‚ùå Abbrechen</button>
                    </div>
                </div>
            `;
        }

        function executeForceTask() {
            game[game.current].money -= 150;
            
            const theme = document.getElementById('forceTheme').value;
            const t = tasks[theme];
            const task = t.list[Math.floor(Math.random() * t.list.length)];
            const other = game.current === 'frau' ? 'mann' : 'frau';
            
            const modal = document.getElementById('modal');
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">üéØ ${t.name}</div>
                    <div class="modal-text">${task}</div>
                    <div style="text-align: center; margin-bottom: 15px;">
                        <strong>Ausf√ºhrend:</strong> ${other === 'frau' ? 'üëë Ehefrau' : 'üîí Ehemann'}<br>
                        <strong>Erzwungen von:</strong> ${game.current === 'frau' ? 'üëë Ehefrau' : 'üîí Ehemann'}
                    </div>
                    <div class="modal-btns">
                        <button class="btn btn-success" onclick="closeModal(); render();">‚úÖ Erledigt</button>
                    </div>
                </div>
            `;
        }

        // =================== INIT ===================
        window.onload = () => {
            render();
            console.log('‚úÖ EROPOLY geladen - Viel Spa√ü!');
        };
    </script>
</body>
</html>
